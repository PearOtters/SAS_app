<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}"> </head>
<body>
    <div class="dashboard-container">
        <div class="dashboard-header">
            <div class="dashboard-header-content">
                <h1>Events Dashboard</h1>
                <p>Browse and manage your events across calendar and map views</p>
            </div>
            
            <div class="user-controls">
                {% if user.is_authenticated %}
                <div class="user-info">
                    <strong>Hello, {{ user.username }}</strong>
                    <span>Ready to plan?</span>
                </div>
                <a href="{% url 'planner:logout' %}" class="btn-logout">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                    </svg>
                    Logout
                </a>
                {% endif %}
                <a href="{% url 'planner:create_event' %}" class="btn-create-event">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    Create Event
                </a>
            </div>
        </div>

        <div class="dashboard-controls" style="margin-bottom: 32px; padding: 20px; background: rgba(0, 217, 255, 0.05); border-radius: 8px;">
            <form id="filterForm" method="GET" action="{% url 'planner:dashboard' %}" style="display: flex; gap: 20px; flex-wrap: wrap; align-items: flex-end;">
                
                <div style="flex-grow: 1; min-width: 200px;">
                    <label for="search_name" style="display: block; margin-bottom: 8px; font-weight: 600;">Search Event Name</label>
                    <input type="text" id="search_name" name="search_name" 
                           value="{{ request.GET.search_name }}" 
                           placeholder="e.g. Workshop, Social Mixer" 
                           style="width: 100%; padding: 10px; border-radius: 4px; border: 1px solid rgba(0, 217, 255, 0.3); background: rgba(26, 26, 26, 0.8); color: #ffffff;">
                </div>

                <div>
                    <label for="budget" style="display: block; margin-bottom: 8px; font-weight: 600;">Cost / Budget</label>
                    <select id="budget" name="budget" 
                            style="padding: 10px; border-radius: 4px; border: 1px solid rgba(0, 217, 255, 0.3); background: rgba(26, 26, 26, 0.8); color: #ffffff;">
                        <option value="">All Budgets</option>
                        <option value="LOW" {% if request.GET.budget == 'LOW' %}selected{% endif %}>Low (£)</option>
                        <option value="MEDIUM" {% if request.GET.budget == 'MEDIUM' %}selected{% endif %}>Medium (££)</option>
                        <option value="HIGH" {% if request.GET.budget == 'HIGH' %}selected{% endif %}>High (£££)</option>
                    </select>
                </div>

                <div>
                    <label for="kind" style="display: block; margin-bottom: 8px; font-weight: 600;">Event Type</label>
                    <select id="kind" name="kind" 
                            style="padding: 10px; border-radius: 4px; border: 1px solid rgba(0, 217, 255, 0.3); background: rgba(26, 26, 26, 0.8); color: #ffffff;">
                        <option value="">All Types</option>
                        <option value="CONCERT" {% if request.GET.kind == 'CONCERT' %}selected{% endif %}>Concert / Gig</option>
                        <option value="CONFERENCE" {% if request.GET.kind == 'CONFERENCE' %}selected{% endif %}>Conference</option>
                        <option value="MEETING" {% if request.GET.kind == 'MEETING' %}selected{% endif %}>Meeting</option>
                        <option value="WORKSHOP" {% if request.GET.kind == 'WORKSHOP' %}selected{% endif %}>Workshop</option>
                        <option value="SOCIAL" {% if request.GET.kind == 'SOCIAL' %}selected{% endif %}>Social / Mixer</option>
                        <option value="EXHIBITION" {% if request.GET.kind == 'EXHIBITION' %}selected{% endif %}>Exhibition / Art</option>
                        <option value="THEATRE" {% if request.GET.kind == 'THEATRE' %}selected{% endif %}>Theatre / Play</option>
                        <option value="COMEDY" {% if request.GET.kind == 'COMEDY' %}selected{% endif %}>Comedy Show</option>
                        <option value="TOUR" {% if request.GET.kind == 'TOUR' %}selected{% endif %}>Tour</option>
                        <option value="FOOD" {% if request.GET.kind == 'FOOD' %}selected{% endif %}>Food & Drink</option>
                        <option value="CLUB" {% if request.GET.kind == 'CLUB' %}selected{% endif %}>Club Night</option>
                        <option value="OTHER" {% if request.GET.kind == 'OTHER' %}selected{% endif %}>Other Event</option>
                    </select>
                </div>

                <div>
                    <label for="min_attendees" style="display: block; margin-bottom: 8px; font-weight: 600;">Min. Attendees</label>
                    <input type="number" id="min_attendees" name="min_attendees" 
                           value="{{ request.GET.min_attendees }}" min="1" 
                           placeholder="e.g. 10" 
                           style="padding: 10px; border-radius: 4px; border: 1px solid rgba(0, 217, 255, 0.3); background: rgba(26, 26, 26, 0.8); color: #ffffff; width: 120px;">
                </div>

                <button type="submit" class="btn-create-event" style="padding: 10px 20px; font-size: 1rem; margin-top: 0; box-shadow: none;">
                    Filter Events
                </button>
            </form>
        </div>

        <div class="dashboard-grid with-list">
            <div class="card event-list-card">
                <div class="card-header">
                    <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                    </svg>
                    <h2>Available Events</h2>
                </div>
                <div class="event-list-container" id="eventList">
                    </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    <h2>Calendar View</h2>
                </div>
                <div class="calendar-container">
                    <div class="calendar-header">
                        <h3 id="currentMonth">January 2025</h3>
                        <div class="calendar-nav">
                            <button onclick="previousMonth()">Previous</button>
                            <button onclick="nextMonth()">Next</button>
                        </div>
                    </div>
                    <div class="calendar-grid" id="calendar">
                        </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    <h2>Event Locations</h2>
                </div>
                <div class="map-container">
                    <div id="map"></div>
                </div>
                <div class="map-info" id="mapInfo">
                    Click on a marker to view event details
                </div>
            </div>
        </div>

        <div class="card event-display-container">
            <div class="card-header">
                <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                <h2>Selected Event Details</h2>
            </div>

            <div id="eventDisplay">
                <div class="display-grid">
                    <div class="display-group full-width">
                        <div class="display-label">Event Name</div>
                        <div class="display-value" id="dispName">Select an event from the list or map.</div>
                    </div>
                    
                    <div class="display-group">
                        <div class="display-label">Date & Time</div>
                        <div class="display-value" id="dispDateTime">-</div>
                    </div>

                    <div class="display-group">
                        <div class="display-label">Location</div>
                        <div class="display-value" id="dispLocation">-</div>
                    </div>
                    
                    <div class="display-group">
                        <div class="display-label">Category</div>
                        <div class="display-value" id="dispCategory">-</div>
                    </div>

                    <div class="display-group">
                        <div class="display-label">Duration</div>
                        <div class="display-value" id="dispDuration">-</div>
                    </div>

                    <div class="display-group">
                        <div class="display-label">Attendees</div>
                        <div class="display-value" id="dispAttendees">-</div>
                    </div>

                    <div class="display-group full-width">
                        <div class="display-label">Description</div>
                        <div class="display-value display-description" id="dispDescription">...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        var eventsDataJson = "{{ events_json|safe|escapejs }}"; 
    </script>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="{% static 'js/dashboard.js' %}"></script> </body>
</html>