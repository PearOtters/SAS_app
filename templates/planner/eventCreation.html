<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Event Creation Dashboard</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    /* Reset and Box Sizing for consistency */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* Define accent color variable for theme consistency */
    :root {
      --color-accent: #00d9ff;
      --color-primary: #7c3aed;
      --color-dark-bg: #1a1a1a;
      --color-card-bg: #2d1b3d;
      --color-light-text: #a0a0a0;
    }

    body {
      /* Refined font stack for better cross-platform compatibility */
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background: linear-gradient(135deg, var(--color-dark-bg) 0%, var(--color-card-bg) 100%);
      color: #ffffff;
      min-height: 100vh;
      padding: 20px;
      background-attachment: fixed; /* Ensures gradient covers viewport */
    }

    .dashboard-container {
      max-width: 1400px;
      margin: 0 auto;
      border: 2px solid var(--color-accent);
      border-radius: 12px;
      padding: 32px;
      background: rgba(26, 26, 26, 0.8);
      backdrop-filter: blur(10px);
    }

    .dashboard-header {
      margin-bottom: 32px;
    }

    .dashboard-header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--color-accent);
      margin-bottom: 8px;
    }

    .dashboard-header p {
      color: var(--color-light-text);
      font-size: 1.1rem;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); 
      gap: 24px;
      margin-bottom: 32px;
    }

    .card {
      background: rgba(45, 27, 61, 0.4);
      border: 1px solid rgba(0, 217, 255, 0.3);
      border-radius: 12px;
      padding: 24px;
      transition: all 0.3s ease;
    }

    .card:hover {
      border-color: var(--color-accent);
      box-shadow: 0 0 20px rgba(0, 217, 255, 0.2);
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(0, 217, 255, 0.2);
    }

    .card-icon {
      width: 32px;
      height: 32px;
      color: var(--color-accent);
    }

    .card-header h2 {
      font-size: 1.5rem;
      font-weight: 600;
      color: #ffffff;
    }

    .calendar-container {
      width: 100%;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .calendar-header h3 {
      font-size: 1.2rem;
      color: var(--color-accent);
    }

    .calendar-nav {
      display: flex;
      gap: 12px;
    }

    .calendar-nav button {
      background: rgba(0, 217, 255, 0.1);
      border: 1px solid var(--color-accent);
      color: var(--color-accent);
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .calendar-nav button:hover {
      background: rgba(0, 217, 255, 0.2);
      transform: translateY(-2px);
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }

    .calendar-day-header {
      text-align: center;
      padding: 12px 8px;
      font-weight: 600;
      color: var(--color-accent);
      font-size: 0.85rem;
    }

    .calendar-day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.95rem;
    }

    .calendar-day:hover {
      background: rgba(0, 217, 255, 0.1);
      border-color: var(--color-accent);
      transform: scale(1.05);
    }

    .calendar-day.selected {
      background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%);
      border-color: var(--color-accent);
      font-weight: 700;
    }

    .calendar-day.other-month {
      opacity: 0.3;
      cursor: default;
    }

    .calendar-day.other-month:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(255, 255, 255, 0.1);
      transform: none;
    }

    .map-container {
      width: 100%;
      height: 400px;
      background: var(--color-dark-bg);
      border: 1px solid rgba(0, 217, 255, 0.3);
      border-radius: 8px;
      overflow: hidden;
      position: relative;
    }

    #map {
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    .map-search {
      margin-bottom: 16px;
    }

    .map-search input {
      width: 100%;
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(0, 217, 255, 0.3);
      border-radius: 8px;
      color: #ffffff;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .map-search input:focus {
      outline: none;
      border-color: var(--color-accent);
      background: rgba(255, 255, 255, 0.08);
    }

    .map-search input::placeholder {
      color: var(--color-light-text);
    }

    .map-info {
      margin-top: 16px;
      padding: 12px;
      background: rgba(0, 217, 255, 0.1);
      border: 1px solid rgba(0, 217, 255, 0.3);
      border-radius: 8px;
      font-size: 0.9rem;
      color: var(--color-accent);
    }
    .error-message {
        border-color: #ff0000; 
        color: #ff0000; 
        margin-bottom: 24px;
        background: rgba(255, 0, 0, 0.1);
    }

    .event-form-container {
      grid-column: 1 / -1;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .form-group label {
      font-size: 0.95rem;
      color: var(--color-light-text);
      font-weight: 500;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(0, 217, 255, 0.3);
      border-radius: 8px;
      color: #ffffff;
      font-size: 1rem;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--color-accent);
      background: rgba(255, 255, 255, 0.08);
    }

    .form-group input::placeholder,
    .form-group textarea::placeholder {
      color: #666;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    .form-actions {
      display: flex;
      gap: 16px;
      justify-content: flex-end;
      margin-top: 24px;
    }

    .btn {
      padding: 14px 32px;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%);
      color: #ffffff;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(124, 58, 237, 0.4);
    }

    .btn-secondary {
      background: rgba(0, 217, 255, 0.1);
      border: 1px solid var(--color-accent);
      color: var(--color-accent);
    }

    .btn-secondary:hover {
      background: rgba(0, 217, 255, 0.2);
      transform: translateY(-2px);
    }

    .selected-info {
      display: flex;
      gap: 24px;
      padding: 16px;
      background: rgba(0, 217, 255, 0.05);
      border: 1px solid rgba(0, 217, 255, 0.2);
      border-radius: 8px;
      margin-bottom: 24px;
    }

    .selected-info-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .selected-info-item svg {
      width: 20px;
      height: 20px;
      color: var(--color-accent);
    }

    .selected-info-item span {
      color: #ffffff;
      font-size: 0.95rem;
    }

    @media (max-width: 768px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }

      .dashboard-header h1 {
        font-size: 2rem;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .selected-info {
        flex-direction: column;
        gap: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <div class="dashboard-header">
      <h1>Create New Event</h1>
      <p>Select a date from the calendar and choose a location</p>
    </div>

    {% if error %}
    <div class="map-info error-message">
        Error: {{ error }}
    </div>
    {% endif %}

    <div class="dashboard-grid">
              <div class="card">
        <div class="card-header">
          <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
          </svg>
          <h2>Select Date</h2>
        </div>
        <div class="calendar-container">
          <div class="calendar-header">
            <h3 id="currentMonth">January 2025</h3>
            <div class="calendar-nav">
              <button type="button" onclick="previousMonth()">Previous</button>
              <button type="button" onclick="nextMonth()">Next</button>
            </div>
          </div>
          <div class="calendar-grid" id="calendar"></div>
        </div>
      </div>

              <div class="card">
        <div class="card-header">
          <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
          </svg>
          <h2>Select Location</h2>
        </div>
        <div class="map-search">
          <input type="text" placeholder="Search for a location or postcode in Glasgow..." id="mapSearch">
        </div>
                <div class="map-container">
          <div id="map"></div>
        </div>
        <div class="map-info" id="mapInfo">
          Click on the map to select event location, or search above.
        </div>
      </div>
    </div>

        <div class="card event-form-container">
      <div class="card-header">
        <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
        </svg>
        <h2>Event Details</h2>
      </div>

      <div class="selected-info">
        <div class="selected-info-item">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
          </svg>
          <span id="selectedDate">No date selected</span>
        </div>
        <div class="selected-info-item">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
          </svg>
          <span id="selectedLocation">No location selected</span>
        </div>
      </div>

      <form id="eventForm" method="POST" action="{% url 'planner:create_event' %}">
        {% csrf_token %}
        
        <input type="hidden" name="selected_date" id="selectedDateInput" required>
        <input type="hidden" name="selectedLat" id="selectedLatInput" required>
        <input type="hidden" name="selectedLng" id="selectedLngInput" required>
        <input type="hidden" name="locationName" id="locationNameInput">
        
        <div class="form-grid">
          <div class="form-group full-width">
            <label for="eventName">Event Name *</label>
            <input type="text" name="eventName" id="eventName" placeholder="Enter event name" required>
          </div>

          <div class="form-group">
            <label for="eventTime">Start Time *</label>
            <input type="time" name="eventTime" id="eventTime" required>
          </div>

          <div class="form-group">
            <label for="eventDuration">Duration (hours)</label>
            <input type="number" name="eventDuration" id="eventDuration" placeholder="2" min="0.5" step="0.5">
          </div>
          
          <div class="form-group">
            <label for="eventAttendees">Expected Attendees</label>
            <input type="number" name="eventAttendees" id="eventAttendees" placeholder="50" min="1">
          </div>
          
          <div class="form-group full-width">
            <label for="eventDescription">Description</label>
            <textarea name="eventDescription" id="eventDescription" placeholder="Enter event description..."></textarea>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="window.location.href='{% url 'planner:dashboard' %}'">Cancel</button>
          <button type="submit" class="btn btn-primary">Create Event</button>
        </div>
      </form>
    </div>
  </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // venuesData is no longer needed
    let venuesData = [];
    
    // Calendar functionality
    let currentDate = new Date();
    let selectedDate = null;
    let map = null;
    let marker = null;
    
    function renderCalendar() {
      const calendar = document.getElementById('calendar');
      const monthYear = document.getElementById('currentMonth');
      
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      
      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                          'July', 'August', 'September', 'October', 'November', 'December'];
      
      monthYear.textContent = `${monthNames[month]} ${year}`;
      
      calendar.innerHTML = '';
      
      const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      dayHeaders.forEach(day => {
        const header = document.createElement('div');
        header.className = 'calendar-day-header';
        header.textContent = day;
        calendar.appendChild(header);
      });
      
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const daysInPrevMonth = new Date(year, month, 0).getDate();
      
      for (let i = firstDay - 1; i >= 0; i--) {
        const day = document.createElement('div');
        day.className = 'calendar-day other-month';
        day.textContent = daysInPrevMonth - i;
        calendar.appendChild(day);
      }
      
      for (let i = 1; i <= daysInMonth; i++) {
        const day = document.createElement('div');
        day.className = 'calendar-day';
        day.textContent = i;
        
        const currentDay = new Date(year, month, i);
        
        if (selectedDate && 
            selectedDate.toDateString() === currentDay.toDateString()) {
          day.classList.add('selected');
        }
        
        day.addEventListener('click', () => selectDate(i, month, year));
        calendar.appendChild(day);
      }
      
      const remainingDays = 42 - (firstDay + daysInMonth);
      for (let i = 1; i <= remainingDays; i++) {
        const day = document.createElement('div');
        day.className = 'calendar-day other-month';
        day.textContent = i;
        calendar.appendChild(day);
      }
    }

    function selectDate(day, month, year) {
      selectedDate = new Date(year, month, day);
      
      const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
      const displayOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      
      document.getElementById('selectedDate').textContent = selectedDate.toLocaleDateString('en-US', displayOptions);
      document.getElementById('selectedDateInput').value = dateStr; 
      
      renderCalendar();
    }

    function previousMonth() {
      currentDate.setMonth(currentDate.getMonth() - 1);
      renderCalendar();
    }

    function nextMonth() {
      currentDate.setMonth(currentDate.getMonth() + 1);
      renderCalendar();
    }

    // Leaflet map initialization and event handlers
    function initMap() {
      // Initialize map centered on Glasgow
      map = L.map('map').setView([55.8642, -4.2518], 13);
      
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors',
        maxZoom: 19
      }).addTo(map);
      
      // No longer adding venue markers as venues are removed

      // 1. Map Click Handler
      map.on('click', function(e) {
        const lat = e.latlng.lat.toFixed(6);
        const lng = e.latlng.lng.toFixed(6);
        
        if (marker) map.removeLayer(marker);
        marker = L.marker([e.latlng.lat, e.latlng.lng]).addTo(map);
        
        // Update display and hidden inputs
        document.getElementById('selectedLocation').textContent = `Lat: ${lat}, Lng: ${lng}`;
        document.getElementById('mapInfo').textContent = `Location set to coordinates: (${lat}, ${lng})`;
        
        document.getElementById('selectedLatInput').value = lat;
        document.getElementById('selectedLngInput').value = lng;
        // Clear location name, assuming click doesn't give a reliable name
        document.getElementById('locationNameInput').value = ''; 
      });
      
      // 2. Map Search Handler
      document.getElementById('mapSearch').addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
              e.preventDefault();
              const query = this.value;
              if (query.trim() === '') return;

              const nominatimUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}, Glasgow, UK&limit=1`;

              document.getElementById('mapInfo').textContent = `Searching for "${query}"...`;

              fetch(nominatimUrl)
                  .then(response => response.json())
                  .then(data => {
                      if (data.length > 0) {
                          const lat = parseFloat(data[0].lat).toFixed(6);
                          const lng = parseFloat(data[0].lon).toFixed(6);
                          const displayName = data[0].display_name;

                          map.setView([lat, lng], 15);
                          document.getElementById('mapInfo').textContent = `Location found: ${displayName}`;

                          if (marker) map.removeLayer(marker);
                          marker = L.marker([lat, lng]).addTo(map);
                          marker.bindPopup(displayName).openPopup();

                          // Update hidden inputs from search result
                          document.getElementById('selectedLatInput').value = lat;
                          document.getElementById('selectedLngInput').value = lng;
                          document.getElementById('locationNameInput').value = displayName;
                          document.getElementById('selectedLocation').textContent = displayName;
                          
                      } else {
                          document.getElementById('mapInfo').textContent = `Could not find location for "${query}". Try a different address or postcode.`;
                      }
                  })
                  .catch(error => {
                      console.error('Geocoding error:', error);
                      document.getElementById('mapInfo').textContent = 'Error during location search. Please try again.';
                  });
          }
      });
    }

    // Form submission validation (Date, Lat, Lng are now required)
    document.getElementById('eventForm').addEventListener('submit', function(e) {
        if (!document.getElementById('selectedDateInput').value) {
            e.preventDefault();
            alert('Please select a date from the calendar.');
            return;
        }
        
        if (!document.getElementById('selectedLatInput').value || !document.getElementById('selectedLngInput').value) {
            e.preventDefault();
            alert('Please select a location on the map or use the search bar.');
            return;
        }
    });

    // Initialize calendar and map on page load
    renderCalendar();
    window.addEventListener('load', initMap);
</script>
</body>
</html>